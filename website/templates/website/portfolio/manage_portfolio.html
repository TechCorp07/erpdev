<!-- templates/website/portfolio/manage_portfolio.html -->
{% extends "website_base.html" %}
{% load static %}

{% block title %}Manage Portfolio - BlitzTech Electronics{% endblock %}

{% block extra_css %}
<style>
/* Custom styles for portfolio management */
.portfolio-image {
    width: 120px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
}
.portfolio-card {
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
}
.portfolio-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    border-color: #007bff;
}
.featured-badge {
    background: linear-gradient(45deg, #ffd700, #ffed4e);
    color: #333;
    font-weight: 600;
    border: none;
}
.project-type-badge {
    font-size: 0.75rem;
    font-weight: 500;
}
.portfolio-stats {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
}
.filter-tabs {
    border-bottom: 2px solid #e9ecef;
}
.filter-tab {
    padding: 0.75rem 1.5rem;
    border: none;
    background: none;
    color: #6c757d;
    text-decoration: none;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}
.filter-tab.active {
    color: #007bff;
    border-bottom-color: #007bff;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2><i class="bi bi-briefcase-fill me-2 text-primary"></i>Manage Portfolio</h2>
      <p class="text-muted mb-0">Showcase your completed projects and success stories</p>
    </div>
    <div>
      <a href="{% url 'website:manage_dashboard' %}" class="btn btn-outline-secondary me-2">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
      </a>
      <a href="{% url 'website:add_portfolio' %}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> New Project
      </a>
    </div>
  </div>

  {% if portfolio_items %}
    <!-- Portfolio Statistics -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="portfolio-stats p-4">
          <div class="row text-center">
            <div class="col-md-3">
              <h3 class="mb-1">{{ portfolio_items.count }}</h3>
              <p class="mb-0 opacity-75">Total Projects</p>
            </div>
            <div class="col-md-3">
              <h3 class="mb-1">{{ portfolio_items|dictsort:"featured"|length|add:"-"|add:portfolio_items.count }}</h3>
              <p class="mb-0 opacity-75">Featured Projects</p>
            </div>
            <div class="col-md-3">
              {% regroup portfolio_items by type as type_groups %}
              <h3 class="mb-1">{{ type_groups|length }}</h3>
              <p class="mb-0 opacity-75">Project Types</p>
            </div>
            <div class="col-md-3">
              {% regroup portfolio_items by categories.all as category_groups %}
              <h3 class="mb-1">
                {% with portfolio_items|dictsort:"date_completed"|last as last_item %}
                {{ last_item.date_completed.year|default:"â€”" }}
                {% endwith %}
              </h3>
              <p class="mb-0 opacity-75">Latest Year</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs mb-4">
      <div class="d-flex">
        <button class="filter-tab active" data-filter="all">
          All Projects <span class="badge bg-primary ms-2">{{ portfolio_items.count }}</span>
        </button>
        <button class="filter-tab" data-filter="featured">
          Featured <span class="badge bg-warning text-dark ms-2">{{ portfolio_items|dictsort:"featured"|length|add:"-"|add:portfolio_items.count }}</span>
        </button>
        {% regroup portfolio_items by get_type_display as type_groups %}
        {% for group in type_groups %}
          <button class="filter-tab" data-filter="{{ group.grouper|slugify }}">
            {{ group.grouper }} <span class="badge bg-secondary ms-2">{{ group.list|length }}</span>
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- Portfolio Items Grid -->
    <div class="row" id="portfolio-grid">
      {% for item in portfolio_items %}
        <div class="col-lg-6 col-xl-4 mb-4 portfolio-item" 
             data-featured="{{ item.featured|yesno:"true,false" }}"
             data-type="{{ item.get_type_display|slugify }}">
          <div class="card portfolio-card h-100">
            <!-- Project Image -->
            {% if item.image %}
              <div class="position-relative">
                <img src="{{ item.image.url }}" 
                     alt="{{ item.title }}" 
                     class="card-img-top"
                     style="height: 200px; object-fit: cover;">
                
                <!-- Featured Badge Overlay -->
                {% if item.featured %}
                  <div class="position-absolute top-0 end-0 m-2">
                    <span class="badge featured-badge">
                      <i class="bi bi-star-fill me-1"></i>Featured
                    </span>
                  </div>
                {% endif %}
                
                <!-- Project Type Badge -->
                <div class="position-absolute bottom-0 start-0 m-2">
                  <span class="badge bg-dark bg-opacity-75 project-type-badge">
                    {{ item.get_type_display }}
                  </span>
                </div>
              </div>
            {% else %}
              <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
              </div>
            {% endif %}

            <div class="card-body">
              <!-- Project Title and Client -->
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">{{ item.title }}</h5>
                <span class="badge bg-secondary">{{ item.order }}</span>
              </div>
              
              {% if item.client %}
                <p class="text-primary mb-2 small">
                  <i class="bi bi-building me-1"></i>{{ item.client }}
                </p>
              {% endif %}

              <!-- Project Description -->
              <p class="card-text text-muted small mb-3">
                {{ item.description|truncatewords:15 }}
              </p>

              <!-- Categories -->
              {% if item.categories.all %}
                <div class="mb-3">
                  {% for category in item.categories.all %}
                    <span class="badge bg-light text-dark me-1">{{ category.name }}</span>
                  {% endfor %}
                </div>
              {% endif %}

              <!-- Project Details -->
              <div class="row small text-muted mb-3">
                <div class="col-6">
                  {% if item.date_completed %}
                    <i class="bi bi-calendar me-1"></i>
                    {{ item.date_completed|date:"M Y" }}
                  {% else %}
                    <i class="bi bi-calendar me-1"></i>
                    Date not set
                  {% endif %}
                </div>
                <div class="col-6 text-end">
                  {% if item.url %}
                    <a href="{{ item.url }}" target="_blank" class="text-decoration-none">
                      <i class="bi bi-link-45deg me-1"></i>View Live
                    </a>
                  {% else %}
                    <span class="text-muted">No URL</span>
                  {% endif %}
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-grid gap-2">
                <div class="btn-group" role="group">
                  <a href="{% url 'website:edit_portfolio' item.pk %}" 
                     class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-pencil me-1"></i>Edit
                  </a>
                  <a href="{% url 'website:portfolio_detail' item.pk %}" 
                     class="btn btn-outline-info btn-sm"
                     target="_blank">
                    <i class="bi bi-eye me-1"></i>View
                  </a>
                  <a href="{% url 'website:delete_portfolio' item.pk %}" 
                     class="btn btn-outline-danger btn-sm"
                     onclick="return confirm('Are you sure you want to delete this project?')">
                    <i class="bi bi-trash me-1"></i>Delete
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- No Items Message (for filtered views) -->
    <div id="no-items-message" class="text-center py-5" style="display: none;">
      <i class="bi bi-funnel display-1 text-muted"></i>
      <h4 class="text-muted mt-3">No Projects Match This Filter</h4>
      <p class="text-muted">Try selecting a different filter or add more projects to your portfolio.</p>
    </div>

  {% else %}
    <!-- Empty State -->
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="bi bi-briefcase-fill display-1 text-muted"></i>
      </div>
      <h4 class="text-muted mb-3">No Portfolio Projects Yet</h4>
      <p class="text-muted mb-4">
        Your portfolio is your chance to show potential clients what you can accomplish.
        <br>
        Start building credibility by showcasing your best work and success stories.
      </p>
      <a href="{% url 'website:add_portfolio' %}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-lg me-2"></i>Add Your First Project
      </a>
      
      <!-- Project Type Examples -->
      <div class="mt-4">
        <h6 class="text-muted">Common project types for electronics companies:</h6>
        <div class="d-flex justify-content-center flex-wrap gap-2 mt-2">
          <span class="badge bg-light text-dark">Security Systems</span>
          <span class="badge bg-light text-dark">IoT Solutions</span>
          <span class="badge bg-light text-dark">PCB Design</span>
          <span class="badge bg-light text-dark">Power Systems</span>
          <span class="badge bg-light text-dark">Drone Technology</span>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Portfolio filtering functionality
    const filterTabs = document.querySelectorAll('.filter-tab');
    const portfolioItems = document.querySelectorAll('.portfolio-item');
    const noItemsMessage = document.getElementById('no-items-message');
    
    filterTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active tab
            filterTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Filter portfolio items
            let visibleCount = 0;
            portfolioItems.forEach(item => {
                let shouldShow = false;
                
                if (filter === 'all') {
                    shouldShow = true;
                } else if (filter === 'featured') {
                    shouldShow = item.dataset.featured === 'true';
                } else {
                    shouldShow = item.dataset.type === filter;
                }
                
                if (shouldShow) {
                    item.style.display = 'block';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show/hide no items message
            if (visibleCount === 0) {
                noItemsMessage.style.display = 'block';
            } else {
                noItemsMessage.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
