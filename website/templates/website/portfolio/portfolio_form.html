<!-- templates/website/portfolio/portfolio_form.html -->
{% extends "website_base.html" %}
{% load crispy_forms_tags %}

{% block title %}{{ title }} - BlitzTech Electronics{% endblock %}

{% block extra_css %}
<style>
/* Custom styles for portfolio form */
.form-section {
    background-color: #fff;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid #e9ecef;
    position: relative;
}
.form-section::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 4px 0 0 4px;
}
.image-preview {
    max-width: 100%;
    max-height: 300px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.category-selector {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    padding: 0.5rem;
}
.project-type-info {
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #bbdefb;
}
.featured-info {
    background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 100%);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #ffcc02;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Form Header -->
      <div class="d-flex align-items-center mb-4">
        <a href="{% url 'website:manage_portfolio' %}" class="btn btn-outline-secondary me-3">
          <i class="bi bi-arrow-left"></i>
        </a>
        <div>
          <h2 class="mb-0">
            <i class="bi bi-briefcase-fill me-2 text-primary"></i>{{ title }}
          </h2>
          <p class="text-muted mb-0">Showcase your completed work and success stories</p>
        </div>
      </div>

      <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}
        
        <!-- Project Information Section -->
        <div class="form-section">
          <h5 class="mb-3">
            <i class="bi bi-info-circle me-2 text-primary"></i>Project Information
          </h5>
          
          <div class="row">
            <div class="col-md-8">
              <div class="mb-3">
                <label for="{{ form.title.id_for_label }}" class="form-label fw-bold">
                  Project Title <span class="text-danger">*</span>
                </label>
                {{ form.title }}
                <div class="form-text">
                  A compelling name that captures what this project accomplished (e.g., "Smart Factory IoT Implementation", "Hospital Security System Upgrade")
                </div>
                {% if form.title.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.title.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="{{ form.type.id_for_label }}" class="form-label fw-bold">
                  Project Type <span class="text-danger">*</span>
                </label>
                {{ form.type }}
                <div class="form-text">
                  Categorize your project type
                </div>
                {% if form.type.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.type.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="{{ form.description.id_for_label }}" class="form-label fw-bold">
              Project Description <span class="text-danger">*</span>
            </label>
            {{ form.description }}
            <div class="form-text">
              Tell the story: What challenge did the client face? How did you solve it? What were the results? Focus on benefits and outcomes.
            </div>
            {% if form.description.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.description.errors %}{{ error }}{% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="{{ form.client.id_for_label }}" class="form-label fw-bold">
                  Client Name
                </label>
                {{ form.client }}
                <div class="form-text">
                  Company or organization name (leave blank for confidential projects)
                </div>
                {% if form.client.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.client.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="{{ form.url.id_for_label }}" class="form-label fw-bold">
                  Project URL
                </label>
                {{ form.url }}
                <div class="form-text">
                  Link to live project, case study, or demo (if publicly accessible)
                </div>
                {% if form.url.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.url.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Project Media Section -->
        <div class="form-section">
          <h5 class="mb-3">
            <i class="bi bi-camera me-2 text-primary"></i>Project Media
          </h5>
          
          <div class="mb-3">
            <label for="{{ form.image.id_for_label }}" class="form-label fw-bold">
              Project Image <span class="text-danger">*</span>
            </label>
            {{ form.image }}
            <div class="form-text">
              High-quality image showcasing the project (recommended: 1200x800px, landscape orientation)
            </div>
            
            {% if object and object.image %}
              <div class="mt-3 text-center">
                <img src="{{ object.image.url }}" 
                     alt="{{ object.title }}" 
                     class="image-preview">
                <br>
                <small class="text-muted mt-2 d-block">Current project image</small>
              </div>
            {% endif %}
            
            {% if form.image.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.image.errors %}{{ error }}{% endfor %}
              </div>
            {% endif %}
          </div>

          <!-- Image Guidelines -->
          <div class="project-type-info">
            <h6 class="mb-2"><i class="bi bi-camera2 me-1"></i>Image Guidelines</h6>
            <div class="row small">
              <div class="col-md-6">
                <p class="mb-1"><strong>âœ“ Good images show:</strong></p>
                <ul class="mb-0">
                  <li>Finished installations or products</li>
                  <li>Before/after comparisons</li>
                  <li>Systems in operation</li>
                  <li>Happy clients using the solution</li>
                </ul>
              </div>
              <div class="col-md-6">
                <p class="mb-1"><strong>Technical specs:</strong></p>
                <ul class="mb-0">
                  <li>Format: JPG, PNG, or WebP</li>
                  <li>Size: Under 2MB for web optimization</li>
                  <li>Dimensions: 1200x800px or similar ratio</li>
                  <li>Quality: High resolution, well-lit</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Categorization & Settings Section -->
        <div class="form-section">
          <h5 class="mb-3">
            <i class="bi bi-tags me-2 text-primary"></i>Categorization & Settings
          </h5>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="{{ form.categories.id_for_label }}" class="form-label fw-bold">
                  Categories
                </label>
                {{ form.categories }}
                <div class="form-text">
                  Hold Ctrl (Cmd on Mac) to select multiple categories
                </div>
                {% if form.categories.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.categories.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="{{ form.date_completed.id_for_label }}" class="form-label fw-bold">
                  Completion Date
                </label>
                {{ form.date_completed }}
                <div class="form-text">
                  When was this project finished? (used for sorting and filtering)
                </div>
                {% if form.date_completed.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.date_completed.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="{{ form.order.id_for_label }}" class="form-label fw-bold">
                  Display Order
                </label>
                {{ form.order }}
                <div class="form-text">
                  {{ form.order.help_text }}
                </div>
                {% if form.order.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.order.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <div class="form-check">
                  {{ form.featured }}
                  <label class="form-check-label fw-bold" for="{{ form.featured.id_for_label }}">
                    Featured Project
                  </label>
                </div>
                <div class="form-text">
                  Featured projects appear prominently on your homepage and portfolio
                </div>
                {% if form.featured.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.featured.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Featured Project Information -->
          <div class="featured-info">
            <h6 class="mb-2"><i class="bi bi-star-fill me-1"></i>About Featured Projects</h6>
            <p class="mb-0 small">
              Featured projects get special visibility on your website. They appear in homepage carousels, 
              portfolio highlights, and are often the first projects potential clients see. Choose your 
              most impressive, representative, or recent work to feature.
            </p>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="d-flex gap-2 pt-3">
          <button class="btn btn-primary btn-lg" type="submit">
            <i class="bi bi-check-lg me-2"></i>
            {% if object %}Update Portfolio Item{% else %}Add to Portfolio{% endif %}
          </button>
          <a href="{% url 'website:manage_portfolio' %}" class="btn btn-outline-secondary btn-lg">
            <i class="bi bi-x-lg me-2"></i>Cancel
          </a>
        </div>
      </form>

      <!-- Portfolio Writing Tips -->
      <div class="mt-4">
        <div class="card border-success">
          <div class="card-header bg-success text-white">
            <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Portfolio Project Tips</h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                <h6 class="text-success">Tell a Story</h6>
                <p class="small mb-3">Start with the client's challenge, explain your solution approach, and highlight the positive outcomes.</p>
              </div>
              <div class="col-md-4">
                <h6 class="text-info">Use Numbers</h6>
                <p class="small mb-3">Include specific metrics: "Reduced energy costs by 30%" or "Installed 50+ security cameras" add credibility.</p>
              </div>
              <div class="col-md-4">
                <h6 class="text-warning">Show Results</h6>
                <p class="small mb-0">Focus on the value delivered: improved security, cost savings, efficiency gains, or problem resolution.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const form = document.querySelector('.needs-validation');
    if (form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });
    }
    
    // Character counter for description
    const descriptionField = document.getElementById('{{ form.description.id_for_label }}');
    if (descriptionField) {
        const counter = document.createElement('div');
        counter.className = 'form-text text-end';
        counter.style.fontSize = '0.8rem';
        
        function updateCounter() {
            const length = descriptionField.value.length;
            const words = descriptionField.value.trim().split(/\s+/).length;
            counter.innerHTML = `${length} characters, ${words} words`;
            
            if (length > 800) {
                counter.className = 'form-text text-end text-warning';
            } else {
                counter.className = 'form-text text-end text-muted';
            }
        }
        
        descriptionField.addEventListener('input', updateCounter);
        descriptionField.parentNode.appendChild(counter);
        updateCounter();
    }
    
    // Image preview on file selection
    const imageField = document.getElementById('{{ form.image.id_for_label }}');
    if (imageField) {
        imageField.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Create or update preview
                    let preview = document.querySelector('.image-preview');
                    if (!preview) {
                        preview = document.createElement('img');
                        preview.className = 'image-preview mt-3';
                        imageField.parentNode.appendChild(preview);
                    }
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Auto-set completion date to today if empty
    const dateField = document.getElementById('{{ form.date_completed.id_for_label }}');
    if (dateField && !dateField.value) {
        const today = new Date().toISOString().split('T')[0];
        dateField.value = today;
    }
});
</script>
{% endblock %}
