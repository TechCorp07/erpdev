<!-- templates/website/testimonials/manage_testimonials.html -->
{% extends "website_base.html" %}
{% load static %}

{% block title %}Manage Testimonials - BlitzTech Electronics{% endblock %}

{% block extra_css %}
<style>
/* Custom styles for testimonials management */
.testimonial-card {
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    overflow: hidden;
}
.testimonial-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    border-color: #007bff;
}
.client-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.rating-stars {
    color: #ffc107;
    font-size: 1.1rem;
}
.testimonial-content {
    font-style: italic;
    line-height: 1.6;
    color: #495057;
}
.testimonial-meta {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 1rem;
    border-top: 1px solid #dee2e6;
}
.status-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 2;
}
.testimonial-stats {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    padding: 2rem;
}
.filter-buttons {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 0.5rem;
}
.filter-btn {
    border: none;
    background: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: all 0.3s ease;
    color: #6c757d;
}
.filter-btn.active {
    background: #007bff;
    color: white;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2><i class="bi bi-star-fill me-2 text-warning"></i>Manage Testimonials</h2>
      <p class="text-muted mb-0">Showcase what clients say about your work and build trust</p>
    </div>
    <div>
      <a href="{% url 'website:manage_dashboard' %}" class="btn btn-outline-secondary me-2">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
      </a>
      <a href="{% url 'website:add_testimonial' %}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> New Testimonial
      </a>
    </div>
  </div>

  {% if testimonials %}
    <!-- Statistics Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="testimonial-stats">
          <div class="row text-center">
            <div class="col-md-3">
              <h3 class="mb-1">{{ testimonials.count }}</h3>
              <p class="mb-0 opacity-75">Total Testimonials</p>
            </div>
            <div class="col-md-3">
              <h3 class="mb-1">{{ testimonials|dictsort:"is_active"|length|add:"-"|add:testimonials.count }}</h3>
              <p class="mb-0 opacity-75">Active Testimonials</p>
            </div>
            <div class="col-md-3">
              {% with testimonials|dictsort:"rating"|last as top_rating %}
              {% if top_rating %}
                <h3 class="mb-1">{{ top_rating.rating|default:0|floatformat:1 }}<small>/5</small></h3>
              {% else %}
                <h3 class="mb-1">0.0<small>/5</small></h3>
              {% endif %}
              <p class="mb-0 opacity-75">Average Rating</p>
              {% endwith %}            
            </div>
            <div class="col-md-3">
              <h3 class="mb-1">
                {% with testimonials|dictsort:"rating"|last as top_testimonial %}
                <h3 class="mb-1">{{ top_testimonial.rating|default:0 }}</h3>
                {% endwith %}              
              </h3>
              <p class="mb-0 opacity-75">Highest Rating</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filter Buttons -->
    <div class="filter-buttons mb-4">
      <div class="d-flex justify-content-center">
        <button class="filter-btn active" data-filter="all">
          All Testimonials <span class="badge bg-primary ms-2">{{ testimonials.count }}</span>
        </button>
        <button class="filter-btn" data-filter="active">
          Active <span class="badge bg-success ms-2">{{ testimonials|dictsort:"is_active"|length|add:"-"|add:testimonials.count }}</span>
        </button>
        <button class="filter-btn" data-filter="inactive">
          Inactive <span class="badge bg-secondary ms-2">{{ testimonials|length|add:"-"|dictsort:"is_active"|length }}</span>
        </button>
        <button class="filter-btn" data-filter="5-star">
          5-Star <span class="badge bg-warning text-dark ms-2">{% for t in testimonials %}{% if t.rating == 5 %}{{ forloop.counter0|add:1 }}{% endif %}{% endfor %}</span>
        </button>
      </div>
    </div>

    <!-- Testimonials Grid -->
    <div class="row" id="testimonials-grid">
      {% for testimonial in testimonials %}
        <div class="col-lg-6 col-xl-4 mb-4 testimonial-item" 
             data-active="{{ testimonial.is_active|yesno:"true,false" }}"
             data-rating="{{ testimonial.rating }}">
          <div class="card testimonial-card h-100 position-relative">
            <!-- Status Badge -->
            <div class="status-badge">
              {% if testimonial.is_active %}
                <span class="badge bg-success">
                  <i class="bi bi-check-circle-fill me-1"></i>Active
                </span>
              {% else %}
                <span class="badge bg-secondary">
                  <i class="bi bi-pause-circle-fill me-1"></i>Inactive
                </span>
              {% endif %}
            </div>

            <div class="card-body">
              <!-- Client Info Header -->
              <div class="d-flex align-items-center mb-3">
                <div class="position-relative">
                  {% if testimonial.image %}
                    <img src="{{ testimonial.image.url }}" 
                         alt="{{ testimonial.name }}" 
                         class="client-avatar">
                  {% else %}
                    <div class="client-avatar bg-primary d-flex align-items-center justify-content-center text-white">
                      {{ testimonial.name|first|upper }}
                    </div>
                  {% endif %}
                </div>
                <div class="ms-3 flex-grow-1">
                  <h6 class="mb-1 fw-bold">{{ testimonial.name }}</h6>
                  <p class="mb-1 text-muted small">{{ testimonial.position }}</p>
                  <p class="mb-0 text-primary small fw-semibold">{{ testimonial.company }}</p>
                </div>
              </div>

              <!-- Rating -->
              <div class="mb-3 text-center">
                <div class="rating-stars">
                  {% for i in "12345" %}
                    {% if forloop.counter <= testimonial.rating %}
                      <i class="bi bi-star-fill"></i>
                    {% else %}
                      <i class="bi bi-star"></i>
                    {% endif %}
                  {% endfor %}
                </div>
                <small class="text-muted">{{ testimonial.rating }}/5 stars</small>
              </div>

              <!-- Testimonial Content -->
              <div class="testimonial-content mb-3">
                <i class="bi bi-quote text-muted me-2"></i>
                {{ testimonial.content|truncatewords:25 }}
                <i class="bi bi-quote text-muted ms-2"></i>
              </div>

              <!-- Display Order -->
              <div class="text-center mb-3">
                <span class="badge bg-light text-dark">
                  <i class="bi bi-sort-numeric-up me-1"></i>Order: {{ testimonial.order }}
                </span>
              </div>

              <!-- Action Buttons -->
              <div class="d-grid gap-2">
                <div class="btn-group" role="group">
                  <a href="{% url 'website:edit_testimonial' testimonial.pk %}" 
                     class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-pencil me-1"></i>Edit
                  </a>
                  <button class="btn btn-outline-info btn-sm" 
                          data-bs-toggle="modal" 
                          data-bs-target="#testimonialModal{{ testimonial.pk }}">
                    <i class="bi bi-eye me-1"></i>Preview
                  </button>
                  <a href="{% url 'website:delete_testimonial' testimonial.pk %}" 
                     class="btn btn-outline-danger btn-sm"
                     onclick="return confirm('Are you sure you want to delete this testimonial?')">
                    <i class="bi bi-trash me-1"></i>Delete
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Testimonial Preview Modal -->
        <div class="modal fade" id="testimonialModal{{ testimonial.pk }}" tabindex="-1">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">
                  <i class="bi bi-eye me-2"></i>Testimonial Preview
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="text-center mb-4">
                  {% if testimonial.image %}
                    <img src="{{ testimonial.image.url }}" 
                         alt="{{ testimonial.name }}" 
                         class="rounded-circle mb-3"
                         style="width: 100px; height: 100px; object-fit: cover;">
                  {% endif %}
                  
                  <div class="rating-stars mb-2">
                    {% for i in "12345" %}
                      {% if forloop.counter <= testimonial.rating %}
                        <i class="bi bi-star-fill"></i>
                      {% else %}
                        <i class="bi bi-star"></i>
                      {% endif %}
                    {% endfor %}
                  </div>
                  
                  <blockquote class="blockquote">
                    <p class="testimonial-content">{{ testimonial.content }}</p>
                  </blockquote>
                  
                  <footer class="blockquote-footer">
                    <strong>{{ testimonial.name }}</strong>, {{ testimonial.position }}
                    <br>
                    <cite title="Company">{{ testimonial.company }}</cite>
                  </footer>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="{% url 'website:edit_testimonial' testimonial.pk %}" class="btn btn-primary">
                  <i class="bi bi-pencil me-1"></i>Edit Testimonial
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- No Items Message (for filtered views) -->
    <div id="no-testimonials-message" class="text-center py-5" style="display: none;">
      <i class="bi bi-funnel display-1 text-muted"></i>
      <h4 class="text-muted mt-3">No Testimonials Match This Filter</h4>
      <p class="text-muted">Try selecting a different filter or add more testimonials.</p>
    </div>

  {% else %}
    <!-- Empty State -->
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="bi bi-star-fill display-1 text-muted"></i>
      </div>
      <h4 class="text-muted mb-3">No Testimonials Yet</h4>
      <p class="text-muted mb-4">
        Client testimonials are one of the most powerful forms of social proof.
        <br>
        Start building credibility by adding testimonials from satisfied customers.
      </p>
      <a href="{% url 'website:add_testimonial' %}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-lg me-2"></i>Add Your First Testimonial
      </a>
      
      <!-- Tips for Getting Testimonials -->
      <div class="mt-4">
        <h6 class="text-muted">Tips for collecting testimonials:</h6>
        <div class="d-flex justify-content-center flex-wrap gap-2 mt-2">
          <span class="badge bg-light text-dark">Follow up after project completion</span>
          <span class="badge bg-light text-dark">Ask specific questions about benefits</span>
          <span class="badge bg-light text-dark">Request permission to use company name</span>
          <span class="badge bg-light text-dark">Get a professional photo if possible</span>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    const testimonialItems = document.querySelectorAll('.testimonial-item');
    const noTestimonialsMessage = document.getElementById('no-testimonials-message');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Filter testimonials
            let visibleCount = 0;
            testimonialItems.forEach(item => {
                let shouldShow = false;
                
                switch(filter) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'active':
                        shouldShow = item.dataset.active === 'true';
                        break;
                    case 'inactive':
                        shouldShow = item.dataset.active === 'false';
                        break;
                    case '5-star':
                        shouldShow = item.dataset.rating === '5';
                        break;
                }
                
                if (shouldShow) {
                    item.style.display = 'block';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show/hide no items message
            if (visibleCount === 0 && filter !== 'all') {
                noTestimonialsMessage.style.display = 'block';
            } else {
                noTestimonialsMessage.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
