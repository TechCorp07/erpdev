<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quote {{ quote.quote_number }} - {{ quote.client.name }}</title>
    <style>
        /* PDF-specific styling optimized for print and digital viewing */
        
        /* Reset and base typography */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #333333;
            background: #ffffff;
        }
        
        /* Page layout and structure */
        .page {
            width: 210mm;
            min-height: 297mm; /* A4 size */
            padding: 20mm;
            margin: 0 auto;
            background: white;
            position: relative;
        }
        
        /* Header section with company branding */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30pt;
            padding-bottom: 20pt;
            border-bottom: 3pt solid #667eea;
        }
        
        .company-info {
            flex: 1;
        }
        
        .company-logo {
            max-width: 150pt;
            max-height: 60pt;
            margin-bottom: 10pt;
        }
        
        .company-name {
            font-size: 18pt;
            font-weight: bold;
            color: #495057;
            margin-bottom: 5pt;
        }
        
        .company-details {
            font-size: 9pt;
            color: #6c757d;
            line-height: 1.3;
        }
        
        .quote-header {
            text-align: right;
            flex: 1;
            max-width: 200pt;
        }
        
        .quote-title {
            font-size: 24pt;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10pt;
        }
        
        .quote-number {
            font-size: 14pt;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15pt;
        }
        
        .quote-meta {
            font-size: 9pt;
            color: #6c757d;
        }
        
        /* Client information section */
        .client-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30pt;
        }
        
        .client-info,
        .quote-details {
            flex: 1;
            padding: 15pt;
            background: #f8f9fa;
            border-radius: 4pt;
            margin: 0 5pt;
        }
        
        .section-title {
            font-size: 12pt;
            font-weight: bold;
            color: #495057;
            margin-bottom: 10pt;
            border-bottom: 1pt solid #dee2e6;
            padding-bottom: 5pt;
        }
        
        .client-name {
            font-size: 14pt;
            font-weight: bold;
            color: #333333;
            margin-bottom: 8pt;
        }
        
        .client-details,
        .quote-info {
            font-size: 10pt;
            line-height: 1.4;
        }
        
        /* Quote items table */
        .items-section {
            margin-bottom: 30pt;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10pt;
            margin-top: 15pt;
        }
        
        .items-table th {
            background: #495057;
            color: white;
            padding: 10pt 8pt;
            text-align: left;
            font-weight: bold;
            font-size: 9pt;
            text-transform: uppercase;
            letter-spacing: 0.5pt;
        }
        
        .items-table th:last-child,
        .items-table td:last-child {
            text-align: right;
        }
        
        .items-table td {
            padding: 8pt;
            border-bottom: 1pt solid #e9ecef;
            vertical-align: top;
        }
        
        .items-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .item-description {
            font-weight: bold;
            color: #333333;
            margin-bottom: 3pt;
        }
        
        .item-specs {
            font-size: 9pt;
            color: #6c757d;
            font-style: italic;
        }
        
        .item-source {
            font-size: 8pt;
            color: #28a745;
            background: #d4edda;
            padding: 2pt 6pt;
            border-radius: 10pt;
            display: inline-block;
            margin-top: 3pt;
        }
        
        /* Financial summary section */
        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30pt;
        }
        
        .totals-table {
            min-width: 250pt;
            border-collapse: collapse;
            font-size: 11pt;
        }
        
        .totals-table td {
            padding: 8pt 15pt;
            border-bottom: 1pt solid #e9ecef;
        }
        
        .totals-table .subtotal-row td {
            font-weight: bold;
        }
        
        .totals-table .discount-row td {
            color: #ffc107;
            font-weight: bold;
        }
        
        .totals-table .total-row {
            background: #28a745;
            color: white;
            font-weight: bold;
            font-size: 14pt;
        }
        
        .totals-table .total-row td {
            border: none;
            padding: 12pt 15pt;
        }
        
        /* Terms and conditions */
        .terms-section {
            margin-top: 40pt;
            padding-top: 20pt;
            border-top: 1pt solid #dee2e6;
        }
        
        .terms-title {
            font-size: 12pt;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15pt;
        }
        
        .terms-content {
            font-size: 9pt;
            line-height: 1.5;
            color: #6c757d;
        }
        
        .terms-content ul {
            padding-left: 15pt;
            margin-bottom: 10pt;
        }
        
        .terms-content li {
            margin-bottom: 5pt;
        }
        
        /* Footer */
        .footer {
            position: absolute;
            bottom: 15mm;
            left: 20mm;
            right: 20mm;
            font-size: 8pt;
            color: #6c757d;
            text-align: center;
            border-top: 1pt solid #e9ecef;
            padding-top: 10pt;
        }
        
        /* Watermark for draft quotes */
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 72pt;
            color: rgba(220, 53, 69, 0.1);
            font-weight: bold;
            z-index: -1;
            pointer-events: none;
        }
        
        /* Page break controls */
        .page-break {
            page-break-before: always;
        }
        
        .no-break {
            page-break-inside: avoid;
        }
        
        /* Print-specific adjustments */
        @media print {
            .page {
                margin: 0;
                box-shadow: none;
                padding: 15mm;
            }
            
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        /* Status-specific styling */
        .status-accepted {
            border-left: 5pt solid #28a745;
            padding-left: 10pt;
        }
        
        .status-expired {
            opacity: 0.7;
        }
        
        .status-draft .watermark {
            display: block;
        }
        
        /* Professional touches */
        .highlight {
            background: #fff3cd;
            padding: 10pt;
            border-left: 3pt solid #ffc107;
            margin: 15pt 0;
            border-radius: 0 3pt 3pt 0;
        }
        
        .signature-section {
            margin-top: 40pt;
            display: flex;
            justify-content: space-between;
        }
        
        .signature-block {
            width: 200pt;
            border-top: 1pt solid #333333;
            padding-top: 5pt;
            text-align: center;
            font-size: 9pt;
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- Watermark for draft quotes -->
        {% if quote.status == 'draft' %}
        <div class="watermark">DRAFT</div>
        {% endif %}
        
        <!-- Header Section -->
        <div class="header">
            <div class="company-info">
                {% if company_info.logo_path %}
                <img src="{{ company_info.logo_path }}" alt="{{ company_info.name }}" class="company-logo">
                {% endif %}
                <div class="company-name">{{ company_info.name }}</div>
                <div class="company-details">
                    {% if company_info.address %}{{ company_info.address }}<br>{% endif %}
                    {% if company_info.phone %}Phone: {{ company_info.phone }}<br>{% endif %}
                    {% if company_info.email %}Email: {{ company_info.email }}<br>{% endif %}
                    {% if company_info.website %}Web: {{ company_info.website }}<br>{% endif %}
                    {% if company_info.tax_number %}Tax No: {{ company_info.tax_number }}{% endif %}
                </div>
            </div>
            
            <div class="quote-header">
                <div class="quote-title">QUOTATION</div>
                <div class="quote-number">{{ quote.quote_number }}</div>
                <div class="quote-meta">
                    <strong>Date:</strong> {{ quote.created_at|date:"d M Y" }}<br>
                    <strong>Valid Until:</strong> {{ quote.validity_date|date:"d M Y" }}<br>
                    <strong>Page:</strong> 1 of 1
                </div>
            </div>
        </div>
        
        <!-- Client and Quote Information -->
        <div class="client-section">
            <div class="client-info">
                <div class="section-title">Bill To</div>
                <div class="client-name">{{ quote.client.name }}</div>
                <div class="client-details">
                    {% if quote.client.company %}{{ quote.client.company }}<br>{% endif %}
                    {% if quote.client.full_address %}{{ quote.client.full_address }}<br>{% endif %}
                    Email: {{ quote.client.email }}<br>
                    {% if quote.client.phone %}Phone: {{ quote.client.phone }}<br>{% endif %}
                    {% if quote.client.tax_number %}Tax No: {{ quote.client.tax_number }}{% endif %}
                </div>
            </div>
            
            <div class="quote-details">
                <div class="section-title">Quote Details</div>
                <div class="quote-info">
                    <strong>Subject:</strong> {{ quote.title }}<br>
                    <strong>Currency:</strong> {{ quote.currency }}<br>
                    <strong>Payment Terms:</strong> {{ quote.payment_terms }} days<br>
                    {% if quote.delivery_terms %}<strong>Delivery:</strong> {{ quote.delivery_terms }}<br>{% endif %}
                    <strong>Prepared By:</strong> {{ quote.created_by.get_full_name|default:quote.created_by.username }}<br>
                    <strong>Status:</strong> 
                    <span class="status-{{ quote.status }}">{{ quote.get_status_display|upper }}</span>
                </div>
            </div>
        </div>
        
        <!-- Quote Description -->
        {% if quote.description %}
        <div class="highlight">
            <strong>Quote Description:</strong><br>
            {{ quote.description }}
        </div>
        {% endif %}
        
        <!-- Quote Items -->
        <div class="items-section no-break">
            <div class="section-title">Items & Services</div>
            
            <table class="items-table">
                <thead>
                    <tr>
                        <th width="5%">#</th>
                        <th width="45%">Description</th>
                        <th width="10%">Qty</th>
                        <th width="15%">Unit Price</th>
                        <th width="15%">Total</th>
                        <th width="10%">Source</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in quote.items.all %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <div class="item-description">{{ item.description }}</div>
                            {% if item.detailed_specs %}
                            <div class="item-specs">{{ item.detailed_specs }}</div>
                            {% endif %}
                            {% if item.product %}
                            <div style="font-size: 8pt; color: #6c757d; margin-top: 3pt;">
                                SKU: {{ item.product.sku }}
                                {% if item.estimated_delivery %}
                                | Est. Delivery: {{ item.estimated_delivery|date:"d M Y" }}
                                {% endif %}
                            </div>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">{{ item.quantity }}</td>
                        <td style="text-align: right;">${{ item.unit_price|floatformat:2 }}</td>
                        <td style="text-align: right; font-weight: bold;">${{ item.total_price|floatformat:2 }}</td>
                        <td style="text-align: center;">
                            <span class="item-source">{{ item.get_source_type_display }}</span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; font-style: italic; color: #6c757d;">
                            No items in this quote
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Quote Totals -->
        <div class="totals-section">
            <table class="totals-table">
                <tr class="subtotal-row">
                    <td>Subtotal:</td>
                    <td style="text-align: right;">${{ quote.subtotal|floatformat:2 }}</td>
                </tr>
                {% if quote.discount_percentage > 0 %}
                <tr class="discount-row">
                    <td>Discount ({{ quote.discount_percentage }}%):</td>
                    <td style="text-align: right;">-${{ quote.discount_amount|floatformat:2 }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td>Tax ({{ quote.tax_rate }}%):</td>
                    <td style="text-align: right;">${{ quote.tax_amount|floatformat:2 }}</td>
                </tr>
                <tr class="total-row">
                    <td>TOTAL ({{ quote.currency }}):</td>
                    <td style="text-align: right;">${{ quote.total_amount|floatformat:2 }}</td>
                </tr>
            </table>
        </div>
        
        <!-- Terms and Conditions -->
        <div class="terms-section">
            <div class="terms-title">Terms & Conditions</div>
            <div class="terms-content">
                <ul>
                    <li><strong>Validity:</strong> This quotation is valid until {{ quote.validity_date|date:"d M Y" }}. Prices may change after this date.</li>
                    <li><strong>Payment:</strong> Payment is due {{ quote.payment_terms }} days from the date of invoice. Late payments may incur additional charges.</li>
                    <li><strong>Delivery:</strong> {% if quote.delivery_terms %}{{ quote.delivery_terms }}{% else %}Delivery terms to be confirmed upon order acceptance.{% endif %}</li>
                    <li><strong>Warranty:</strong> All products are covered by manufacturer's warranty. Extended warranty options available upon request.</li>
                    <li><strong>Changes:</strong> Any changes to this quotation must be agreed upon in writing before order processing.</li>
                    <li><strong>Acceptance:</strong> Acceptance of this quotation constitutes agreement to these terms and conditions.</li>
                </ul>
                
                <p style="margin-top: 15pt;">
                    <strong>Note:</strong> All prices are in {{ quote.currency }} and exclude delivery charges unless otherwise specified. 
                    Technical specifications are subject to manufacturer's current standards.
                </p>
            </div>
        </div>
        
        <!-- Signature Section -->
        {% if quote.status in 'sent,accepted' %}
        <div class="signature-section">
            <div class="signature-block">
                <strong>Client Acceptance</strong><br>
                Date: _______________
            </div>
            <div class="signature-block">
                <strong>{{ company_info.name }}</strong><br>
                {{ quote.created_by.get_full_name|default:quote.created_by.username }}
            </div>
        </div>
        {% endif %}
        
        <!-- Footer -->
        <div class="footer">
            Thank you for choosing {{ company_info.name }} • 
            Quote {{ quote.quote_number }} • 
            Generated on {{ generated_date|date:"d M Y \a\t H:i" }}
            {% if generated_by %} by {{ generated_by.get_full_name|default:generated_by.username }}{% endif %}
        </div>
    </div>
</body>
</html>