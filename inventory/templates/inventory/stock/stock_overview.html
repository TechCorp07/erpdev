{% extends "inventory_base.html" %}
{% load static %}

{% block inventory_title %}
  Stock Overview
{% endblock %}

{% block inventory_actions %}
<div class="btn-group me-2" role="group">
  <a href="{% url 'inventory:dashboard' %}" class="btn btn-outline-primary btn-sm">
    <i class="bi bi-house-door me-1"></i>Dashboard
  </a>
  <a href="{% url 'inventory:stock_movements' %}" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-list-ul me-1"></i>Movement History
  </a>
  <a href="{% url 'inventory:stock_adjust' %}" class="btn btn-outline-warning btn-sm">
    <i class="bi bi-plus-minus me-1"></i>Adjust Stock
  </a>
  <a href="{% url 'inventory:stock_transfer' %}" class="btn btn-outline-info btn-sm">
    <i class="bi bi-arrow-left-right me-1"></i>Transfer
  </a>
</div>
{% endblock %}

{% block inventory_content %}

<!-- Summary Cards -->
<div class="row mb-4">
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card dashboard-metric info">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <div class="text-xs font-weight-bold text-uppercase mb-1">Total Products</div>
            <div class="h5 mb-0 font-weight-bold">{{ total_products|default:0 }}</div>
          </div>
          <div class="ms-2">
            <i class="bi bi-box-seam fa-2x"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card dashboard-metric success">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <div class="text-xs font-weight-bold text-uppercase mb-1">Total Stock Value</div>
            <div class="h5 mb-0 font-weight-bold">${{ total_value|floatformat:2|default:"0.00" }}</div>
          </div>
          <div class="ms-2">
            <i class="bi bi-currency-dollar fa-2x"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card dashboard-metric {% if low_stock_count > 10 %}critical{% elif low_stock_count > 5 %}warning{% else %}info{% endif %}">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <div class="text-xs font-weight-bold text-uppercase mb-1">Low Stock</div>
            <div class="h5 mb-0 font-weight-bold">{{ low_stock_count|default:0 }}</div>
          </div>
          <div class="ms-2">
            <i class="bi bi-exclamation-triangle fa-2x"></i>
          </div>
        </div>
        <div class="mt-2">
          <a href="{% url 'inventory:low_stock' %}" class="text-white text-decoration-none">
            <i class="bi bi-arrow-right-circle"></i> View Low Stock
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card dashboard-metric info">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <div class="text-xs font-weight-bold text-uppercase mb-1">Total Quantity</div>
            <div class="h5 mb-0 font-weight-bold">{{ total_quantity|default:0 }}</div>
          </div>
          <div class="ms-2">
            <i class="bi bi-stack fa-2x"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Filter Row (optional, can be enhanced) -->
<div class="card inventory-card mb-4">
  <div class="card-header">
    <h6 class="card-title mb-0">
      <i class="bi bi-funnel me-2"></i>Filter & Search
    </h6>
  </div>
  <div class="card-body">
    <form method="get" class="row g-3">
      <div class="col-md-3">
        <label class="form-label">Category</label>
        <select class="form-select" name="category">
          <option value="">All</option>
          {% for category in categories %}
            <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
              {{ category.name }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Supplier</label>
        <select class="form-select" name="supplier">
          <option value="">All</option>
          {% for supplier in suppliers %}
            <option value="{{ supplier.id }}" {% if selected_supplier == supplier.id|stringformat:"s" %}selected{% endif %}>
              {{ supplier.name }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-search"></i> Apply
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Product Stock Table -->
<div class="card inventory-card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h6 class="card-title mb-0">
      <i class="bi bi-list-ul me-2"></i>Stock Overview Table
    </h6>
    <div>
      <a href="{% url 'inventory:product_create' %}" class="btn btn-success btn-sm">
        <i class="bi bi-plus-circle me-1"></i>Add Product
      </a>
      <a href="{% url 'inventory:product_export' %}?format=csv" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-download me-1"></i>Export CSV
      </a>
    </div>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover table-striped mb-0">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>SKU</th>
            <th>Category</th>
            <th>Supplier</th>
            <th>Current Stock</th>
            <th>Reserved</th>
            <th>Available</th>
            <th>Reorder Level</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for product in products %}
          <tr>
            <td>
              <a href="{% url 'inventory:product_detail' product.pk %}" class="fw-bold text-decoration-none">
                {{ product.name }}
              </a>
            </td>
            <td>{{ product.sku }}</td>
            <td>{{ product.category.name }}</td>
            <td>{{ product.supplier.name }}</td>
            <td>
              <span class="badge bg-{% if product.current_stock <= product.reorder_level %}warning text-dark{% else %}success{% endif %}">
                {{ product.current_stock }}
              </span>
            </td>
            <td>{{ product.reserved_stock }}</td>
            <td>{{ product.available_stock }}</td>
            <td>{{ product.reorder_level }}</td>
            <td>
              {% if product.stock_status == 'low_stock' %}
                <span class="badge bg-warning text-dark">Low Stock</span>
              {% elif product.stock_status == 'out_of_stock' %}
                <span class="badge bg-danger">Out of Stock</span>
              {% elif product.stock_status == 'in_stock' %}
                <span class="badge bg-success">In Stock</span>
              {% elif product.stock_status == 'discontinued' %}
                <span class="badge bg-secondary">Discontinued</span>
              {% else %}
                <span class="badge bg-info">Other</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'inventory:product_detail' product.pk %}" class="btn btn-sm btn-outline-primary" title="View">
                <i class="bi bi-eye"></i>
              </a>
              <a href="{% url 'inventory:adjust_stock' product.pk %}" class="btn btn-sm btn-outline-warning" title="Adjust Stock">
                <i class="bi bi-plus-minus"></i>
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="10" class="text-center text-muted py-4">
              <i class="bi bi-check-circle text-success"></i> No products found for your filters.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
