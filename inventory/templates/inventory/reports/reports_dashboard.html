{% extends "dashboard_base.html" %}
{% load static %}

{% block page_title %}Inventory Reports{% endblock %}

{% block dashboard_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0 text-gray-800">Inventory Reports & Analytics</h1>
  <div class="btn-group" role="group">
    <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
      <i class="bi bi-download me-2"></i>Export Data
    </button>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item" href="{% url 'inventory:product_export' %}">
        <i class="bi bi-file-spreadsheet me-2"></i>Products (CSV)
      </a></li>
      <li><a class="dropdown-item" href="{% url 'inventory:stock_movements_export' %}">
        <i class="bi bi-file-spreadsheet me-2"></i>Stock Movements (CSV)
      </a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item" href="{% url 'inventory:export_report' 'valuation' %}?format=excel">
        <i class="bi bi-file-excel me-2"></i>Valuation Report (Excel)
      </a></li>
    </ul>
  </div>
</div>

<!-- KPI Cards -->
<div class="row mb-4">
  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card bg-info text-white shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-white-50 text-uppercase mb-1">
              Total Products
            </div>
            <div class="h5 mb-0 font-weight-bold">{{ total_products|default:0 }}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-box-seam fa-2x text-white-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card bg-success text-white shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-white-50 text-uppercase mb-1">
              Total Stock Value
            </div>
            <div class="h5 mb-0 font-weight-bold">${{ total_stock_value|floatformat:0|default:0 }}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-currency-dollar fa-2x text-white-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card bg-warning text-white shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-white-50 text-uppercase mb-1">
              Low Stock Items
            </div>
            <div class="h5 mb-0 font-weight-bold">{{ low_stock_count|default:0 }}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-exclamation-triangle fa-2x text-white-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card bg-danger text-white shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-white-50 text-uppercase mb-1">
              Out of Stock
            </div>
            <div class="h5 mb-0 font-weight-bold">{{ out_of_stock_count|default:0 }}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-x-circle fa-2x text-white-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reports Grid -->
<div class="row mb-4">
  <!-- Standard Reports -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="bi bi-bar-chart me-2"></i>Standard Reports
        </h6>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          <a href="{% url 'inventory:stock_valuation_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-currency-dollar me-2 text-success"></i>
              <strong>Stock Valuation Report</strong>
              <br><small class="text-muted">Current inventory value by category and location</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
          
          <a href="{% url 'inventory:low_stock_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-exclamation-triangle me-2 text-warning"></i>
              <strong>Low Stock Report</strong>
              <br><small class="text-muted">Products requiring reorder</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
          
          <a href="{% url 'inventory:stock_aging_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-clock me-2 text-info"></i>
              <strong>Stock Aging Report</strong>
              <br><small class="text-muted">Slow-moving and dead stock analysis</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
          
          <a href="{% url 'inventory:inventory_turnover_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-arrow-repeat me-2 text-primary"></i>
              <strong>Inventory Turnover</strong>
              <br><small class="text-muted">Stock movement and turnover analysis</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics & Advanced Reports -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow h-100">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="bi bi-graph-up me-2"></i>Analytics & Insights
        </h6>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          <a href="{% url 'inventory:abc_analysis_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-pie-chart me-2 text-success"></i>
              <strong>ABC Analysis</strong>
              <br><small class="text-muted">Product classification by value and volume</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
          
          <a href="{% url 'inventory:supplier_performance_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-people me-2 text-warning"></i>
              <strong>Supplier Performance</strong>
              <br><small class="text-muted">Lead times, reliability, and cost analysis</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
          
          <a href="{% url 'inventory:category_analysis_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-tags me-2 text-info"></i>
              <strong>Category Analysis</strong>
              <br><small class="text-muted">Performance metrics by product category</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
          
          <a href="{% url 'inventory:custom_report' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-gear me-2 text-primary"></i>
              <strong>Custom Report Builder</strong>
              <br><small class="text-muted">Create custom reports with filters</small>
            </div>
            <i class="bi bi-chevron-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Activity Charts -->
<div class="row">
  <div class="col-lg-8 mb-4">
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Stock Movements (Last 30 Days)</h6>
      </div>
      <div class="card-body">
        <div class="chart-area">
          <canvas id="stockMovementChart"></canvas>
        </div>
        <hr>
        <p class="text-center">
          <i class="bi bi-info-circle me-1"></i>
          Total movements: {{ movements_last_30_days|default:0 }} 
          | Value: ${{ total_value_last_30_days|floatformat:0|default:0 }}
        </p>
      </div>
    </div>
  </div>

  <div class="col-lg-4 mb-4">
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Top Categories by Value</h6>
      </div>
      <div class="card-body">
        {% for category in top_categories %}
        <div class="d-flex align-items-center mb-3">
          <div class="me-3">
            <div class="icon-circle bg-primary">
              <i class="bi bi-tag text-white"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <div class="fw-bold">{{ category.name }}</div>
            <div class="text-muted small">{{ category.product_count }} products</div>
          </div>
          <div class="text-end">
            <div class="fw-bold">${{ category.total_value|floatformat:0|default:0 }}</div>
          </div>
        </div>
        {% empty %}
        <div class="text-center text-muted">
          <i class="bi bi-inbox"></i> No category data available
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
// Stock Movement Chart
const ctx = document.getElementById('stockMovementChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: [], // Add your date labels here
        datasets: [{
            label: 'Stock In',
            data: [], // Add your stock in data
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }, {
            label: 'Stock Out', 
            data: [], // Add your stock out data
            borderColor: 'rgb(255, 99, 132)',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}